{"kind":"article","metadata":{"role":"article","modules":[{"name":"VigramSDK"}],"roleHeading":"Article","title":"Using Combine and Publishers","images":[{"type":"icon","identifier":"logo.png"}]},"sections":[],"schemaVersion":{"major":0,"minor":3,"patch":0},"identifier":{"interfaceLanguage":"swift","url":"doc:\/\/com.vigram.VigramSDK\/documentation\/VigramSDK\/UseCombineAndPublishers"},"hierarchy":{"paths":[["doc:\/\/com.vigram.VigramSDK\/documentation\/VigramSDK"]]},"variants":[{"traits":[{"interfaceLanguage":"swift"}],"paths":["\/documentation\/vigramsdk\/usecombineandpublishers"]}],"primaryContentSections":[{"content":[{"anchor":"Overview","type":"heading","level":2,"text":"Overview"},{"type":"paragraph","inlineContent":[{"text":"The Combine framework provides a declarative Swift API for processing values over time. These values can represent many kinds of asynchronous events. Combine declares publishers to expose values that can change over time, and subscribers to receive those values from the publishers.","type":"text"},{"type":"text","text":" "},{"text":"The Publisher protocol declares a type that can deliver a sequence of values over time. Publishers have operators to act on the values received from upstream publishers and republish them.","type":"text"},{"type":"text","text":" "},{"text":"At the end of a chain of publishers, a Subscriber acts on elements as it receives them. Publishers only emit values when explicitly requested to do so by subscribers. This puts your subscriber code in control of how fast it receives events from the publishers it’s connected to.","type":"text"}]},{"type":"paragraph","inlineContent":[{"text":"More detailed information about Combine can be found in ","type":"text"},{"type":"reference","identifier":"https:\/\/developer.apple.com\/documentation\/combine","isActive":true}]},{"level":2,"text":"Custom typealias used in SDK","anchor":"Custom-typealias-used-in-SDK","type":"heading"},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"text":"A Publisher that never emits a failure event.","type":"text"}],"type":"paragraph"}]}]},{"type":"paragraph","inlineContent":[{"text":"This typealias is mostly used in scenarios, where a publisher represents a certain state and will most likely never complete.","type":"text"}]},{"syntax":null,"code":["public typealias StatePublisher<Element> = AnyPublisher<Element, Never>"],"type":"codeListing"},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"type":"text","text":"A Publisher that may emit any failure event."}],"type":"paragraph"}]}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"This typealias is used in situations, where a publisher represents a certain operation that may fail and completes right after emitting a single output value."}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"Depending on the situation, it may also emit multiple or no output values before completing."}]},{"syntax":null,"type":"codeListing","code":["public typealias SingleEventPublisher<Element> = ","    AnyPublisher<Element, Error>"]},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"A Publisher that may emit any failure event.","type":"text"}]}]}]},{"inlineContent":[{"type":"text","text":"This typealias is used in situations, where a publisher represents a certain operation that may fail and may emit multiple output values before completing."}],"type":"paragraph"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Depending on the situation, it may also emit multiple or no output values before completing."}]},{"code":["public typealias EventsPublisher<Element> = AnyPublisher<Element, Error>"],"type":"codeListing","syntax":null},{"text":"Examples of use","anchor":"Examples-of-use","type":"heading","level":2},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"StatePublisher","type":"text"}]}]}],"type":"unorderedList"},{"type":"paragraph","inlineContent":[{"type":"image","identifier":"fig10.png"}]},{"inlineContent":[{"type":"text","text":"In this example we subscribe to the current viDoc’s (Peripheral) NMEA message publisher"}],"type":"paragraph"},{"syntax":null,"type":"codeListing","code":["peripheral.nmea.sink { message in","    \/\/ do something with NMEA Message","}.store(in: &subscriptions)"]},{"type":"paragraph","inlineContent":[{"text":"In this case we save the subscriptions in Set","type":"text"}]},{"code":["var subscriptions = Set<AnyCancellable>()"],"type":"codeListing","syntax":null},{"inlineContent":[{"inlineContent":[{"type":"text","text":"Note:"}],"type":"strong"},{"type":"text","text":" It is important to remember that it is necessary to remove subscriptions from the "},{"type":"strong","inlineContent":[{"text":"Set","type":"text"}]},{"text":" that we do not need, otherwise it may lead to a memory leak.","type":"text"}],"type":"paragraph"},{"type":"paragraph","inlineContent":[{"type":"text","text":"If there is no need to subscribe to multiple publishers, but only one subscription, you can use a variable:"}]},{"type":"codeListing","syntax":null,"code":["var subscription: AnyCancellable?","","subscription = peripheral.nmea.sink { message in","    \/\/ do something with NMEA Message","}","","subscription = nil \/\/ If you no longer need a subscription"]},{"items":[{"content":[{"inlineContent":[{"type":"text","text":"SingleEventPublisher"}],"type":"paragraph"}]}],"type":"unorderedList"},{"type":"paragraph","inlineContent":[{"identifier":"fig11.png","type":"image"}]},{"inlineContent":[{"type":"text","text":"In this example we make request to receive the battery value of current  viDoc’s (Peripheral)"}],"type":"paragraph"},{"code":["peripheral.requestBattery().sink(receiveCompletion: { completion in","    switch completion {","    case .finished:","        break \/\/ Normal completion","    case .failure(let error):","        \/\/ do something with error receive value","    }","}) { value in ","    \/\/ do something with value","}.store(in: &subscriptions)"],"type":"codeListing","syntax":null},{"inlineContent":[{"text":"This example has a completion block where you can track normal completion or an error.","type":"text"}],"type":"paragraph"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Normal completion is when the value is successfully received."}]},{"inlineContent":[{"type":"text","text":"An error is an inability to obtain a value. In this case, for example, you might get the error "},{"type":"strong","inlineContent":[{"type":"text","text":"device is busy"}]},{"text":" if you request the battery value during viDoc configuration","type":"text"}],"type":"paragraph"},{"type":"paragraph","inlineContent":[{"text":"Using viDoc requests is discussed in more detail in the Connecting to viDoc section.","type":"text"}]}],"kind":"content"}],"references":{"fig10.png":{"alt":"Fig.10","type":"image","identifier":"fig10.png","variants":[{"traits":["1x","light"],"url":"\/images\/com.vigram.VigramSDK\/fig10.png"}]},"logo.png":{"alt":"Vigram logo.","type":"image","identifier":"logo.png","variants":[{"url":"\/images\/com.vigram.VigramSDK\/logo.png","traits":["1x","light"]}]},"doc://com.vigram.VigramSDK/documentation/VigramSDK":{"kind":"symbol","title":"VigramSDK","role":"collection","identifier":"doc:\/\/com.vigram.VigramSDK\/documentation\/VigramSDK","images":[{"identifier":"logo.png","type":"icon"}],"url":"\/documentation\/vigramsdk","abstract":[],"type":"topic"},"fig11.png":{"alt":"Fig.11","type":"image","identifier":"fig11.png","variants":[{"url":"\/images\/com.vigram.VigramSDK\/fig11.png","traits":["1x","light"]}]},"https://developer.apple.com/documentation/combine":{"url":"https:\/\/developer.apple.com\/documentation\/combine","type":"link","identifier":"https:\/\/developer.apple.com\/documentation\/combine","titleInlineContent":[{"type":"text","text":"this section."}],"title":"this section."}}}